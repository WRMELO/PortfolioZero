{
    "task_id": "TASK_A_017",
    "name": "BUILD_PORTFOLIO_SNAPSHOT_V1_FROM_PARQUET",
    "title": "Gera PORTFOLIO_SNAPSHOT_V1.json a partir de Parquet (ticker, quantity, avg_price) e valida contrato minimo",
    "inputs": {
      "repo_path": "/home/wilson/PortfolioZero",
      "gate_allowlist": [
        "planning/task_specs/",
        "planning/runs/",
        "planning/reports/",
        "scripts/",
        "modules/",
        "config/",
        "data/"
      ]
    },
    "workflow": [
      {
        "step_id": "S1_GATE_ALLOWLIST",
        "type": "shell",
        "artifacts": [
          "planning/runs/TASK_A_017/S1_GATE_ALLOWLIST.txt"
        ],
        "commands": [
          "cd /home/wilson/PortfolioZero && git status --porcelain | head -n 200"
        ]
      },
      {
        "step_id": "S2_CHECK_COMPILE_BUILDER",
        "type": "shell",
        "artifacts": [
          "planning/runs/TASK_A_017/S2_CHECK_COMPILE_BUILDER.txt"
        ],
        "commands": [
          "cd /home/wilson/PortfolioZero && python -m py_compile scripts/build_portfolio_snapshot_v1_from_parquet.py"
        ]
      },
      {
        "step_id": "S3_RUN_BUILDER",
        "type": "shell",
        "artifacts": [
          "planning/runs/TASK_A_017/S3_RUN_BUILDER.txt",
          "data/portfolio/PORTFOLIO_SNAPSHOT_V1.json"
        ],
        "commands": [
          "cd /home/wilson/PortfolioZero && python scripts/build_portfolio_snapshot_v1_from_parquet.py --in-parquet data/portfolio/PORTFOLIO_POSITIONS_REAL.parquet --out data/portfolio/PORTFOLIO_SNAPSHOT_V1.json --capital-brl 0 --cash-brl 0 --notes \"REAL_SNAPSHOT_V1_FROM_PARQUET\""
        ]
      },
      {
        "step_id": "S4_VERIFY_CONTRACT_MIN",
        "type": "shell",
        "artifacts": [
          "planning/runs/TASK_A_017/S4_VERIFY_CONTRACT_MIN.txt"
        ],
        "commands": [
          "cd /home/wilson/PortfolioZero && test -f data/portfolio/PORTFOLIO_SNAPSHOT_V1.json",
          "cd /home/wilson/PortfolioZero && python -c \"import json; p='data/portfolio/PORTFOLIO_SNAPSHOT_V1.json'; d=json.load(open(p)); assert list(sorted(d.keys()))==list(sorted(['capital_brl','cash_brl','generated_at_utc','notes','positions','version'])); assert isinstance(d['positions'], list); assert all(set(x.keys())==set(['ticker','quantity','avg_price']) for x in d['positions']); print('OK_CONTRACT positions=', len(d['positions']))\""
        ]
      }
    ]
  }
  